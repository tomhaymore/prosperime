
{% extends "base_full.html" %}

{% block head %}

<!-- CSS -->
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/chosen.css"/>
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/home.css"/>

<!-- JS -->
	<script type="text/javascript" src="{{ STATIC_URL }}js/chosen.jquery.min.js"></script>



{% endblock %}

{% block extramessage %} {% endblock %}

{% block content %}

	
<!-- Main -->
<div id="question-page-container" class="row-fluid">

	<!-- Left -->
	<div class="span2">
		
	</div>
	
	<!-- Center -->
	<div class="span8">
		<div class="form-module" style="text-align:center;">

			<div class="ask-header">Start a Conversation</div>

			<form id="ask-question-form">
				<div class="control-group"> <!-- TODO: add maxlength attributes to these -->
					<input id="ask-form-title" type="text" name="title" placeholder="Question Title" maxlength="200" autofocus />
					<label>Keep the title of your question short and to the point. Something like: <br/>
						<i>What are the most important skills to develop in college for an aspiring management consultant?</i>
					</label>
				</div>

				<div class="control-group">
					<textarea title="body" placeholder="Your question here"></textarea>
					<label>Here, dive into the specifics that are relevant to you and your question. Describe your background, skills, and interests. Even more importantly, detail your goals and where you hope to be in the future.</label>
				</div>

				<div class="control-group">	
					<select class="chzn-select" multiple data-placeholder="Tags">
						{% for t in tags %}
							<option value="{{t.id}}">{{t.name}}</option>
						{% endfor %}
					</select>	
					<label>Add all tags that are relevant to this question--tags help other people like you find this question, and it helps potential answerers get you the knowledge that you need!</label>
				</div>	

				<div class="submit-button disabled">Post Question</div>
		</div>
	</div>

	<!-- Right --> 
	<div class="span2">
		
	</div>
</div>

	
{% endblock %}

{% block templates %}

<!-- V3 Script -->
<script type="text/javascript">
	
	$(function() {
		// Activate Chosen for tags
		$(".chzn-select").chosen();

		// Listen for valid form
		$(document).on("keypress", checkForm).on("click", checkForm);

		// Click on form
		$(".submit-button").on("click", submitForm)
	});


	function checkForm(ev) {
		// See if form is valid
		// Currently, no minimum # of tags requirement
		// TODO: any sort of validation
		if($("#ask-form-title").val().length != 0 && $("#ask-question-form textarea").val().length != 0) {
			// form is valid
			if ($(".disabled").length > 0) 
				$(".submit-button").removeClass("disabled")
		} else {
			// form is not valid
			if ($(".disabled").length == 0)
				$(".submit-button").addClass("disabled")
		}
	};


	function submitForm(ev) {
		// Don't allow if disabled
		if ($(ev.currentTarget).hasClass("disabled")) return false;

		var title = $("#ask-question-form").find("input :first").val(),
			body = $("#ask-question-form").find("textarea").val(),
			tag_ids = $("#ask-question-form").find("select").val(),
			conversation_id;

		console.log(tag_ids)
		
		// TODO: AJAX to DB
		$.ajax({
			type: "POST",
			url: "/api/startConversation/",
			data: {"title":title, "body":body, "tags":tag_ids, "csrfmiddlewaretoken":"{{csrf_token}}"},
			dataType:"json",
			beforeSend: function() {

			},
			success:function(response) {
				if (response["result"] == "success") {
					console.log("success")
					conversation_id = response["conversation_id"]
					formSuccess(conversation_id)

				} else console.log(response["errors"])
			},
			complete:function() {
			}
		});
	};

	function formSuccess(id) {
		$(".submit-button").fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150)
		window.location = "/question/" + id + "/"
	};



</script>



{% endblock %}