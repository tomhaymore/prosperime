{% extends "base_full.html" %}

{% block head %}
<!-- Head -->
<script type="text/javascript" src="{{ STATIC_URL }}js/viz.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/drag_and_drop.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.autocomplete.js"></script>
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/profile.css" />

{% endblock %}



<!-- Content -->
{% block content %}


<!-- Header -->
<div class="main-container content-container">
	<p class="main-header">Profile: <span class="splash-slug">{{profile.first_name}} {{profile.last_name}}</span></p>
<<<<<<< HEAD
	<p class="main-sub-header">{{profile.headline}}</p>
=======
	<div class="pull-left">
		<img class="logo-preview" src="/media/{{profile.default_profile_pic}}" />
	</div>
	<div class="pull-left">
		<p class="main-sub-header">{{profile.headline}}</p>
	</div>
	<div class="clear"></div>
	<div class="profile-careers-container">
		{% if user.profile.all_careers %}
		<ul class="profile-careers-list flat">
			{% for c in user.profile.all_careers %}
				<li class="profile-career"><a class="profile-button" href="/discover/career/{{c.id}}">{{c.long_name}}</a></li>
			{% endfor %}
		</ul>
		{% endif %}
		<div class="clear"></div>
	</div>
>>>>>>> 847140c0045ffa11f1cf7c7f0528281c65d22d84


<!-- Center --> 
	<div class="profile-container"  ondragover='allowDrop(event)'>
		<!-- <div class="profile-nav-container">&nbsp;</div> -->
		<div class="profile-info-container">
			<div class="profile-info-left pull-left span9">
<<<<<<< HEAD
				<div class="profile-info-top">
					<div id='profile-left' class="pull-left span6">	
						<div class="profile-img-holder pull-left">
							<img class="logo-preview" src="/media/{{profile.default_profile_pic}}" />
						</div>
							

						<div class="profile-brief-info pull-left">
							<p class="path-name">
								{{profile.first_name}} {{profile.last_name}}</p>
							<p class="path-current-position">
								{% if current %}
									{{current.title}}
								{% else %}
									{{profile.headline}}
								{% endif %}
							</p>
						</div>
=======
				<p class="main-header">Timeline</p>
			
				<div class="profile-viz-container">
					<!-- TIMELINE. DON'T. TOUCH. IT. -->
					{% if orgs|length > 0 %}
					<div class="timeline-container span12">
						<table class="timeline">
							<!-- Row per Position -->
							{% for p in orgs %}
								<tr class="timeline-row">
									{% load months_difference rangify subtract divide %}

									{% if compress %}
										{% for i in start_date|months_difference:start_date|divide:2|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% else %}
										{% for i in p.start_date|months_difference:start_date|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% endif %}

									<!-- Highlighted Segment -->
									<td class="timeline-col-highlighted" colspan="{{p.duration}}">{{p.co_name}}</td>

									{% if compress %}
										{% for i in end_date|months_difference:p.end_date|divide:2|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% else %}
										{% for i in end_date|months_difference:p.end_date|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% endif %}
								</tr>
							{% endfor %}

							<!-- Bottom Row -->
							<tr class="timeline-row-bottom">
								<td class="timeline-col-start" colspan="{% widthratio total_time 2 1 %}">
									{{start_date.month}}/{{start_date.year}}
								</td>
								<td class="timeline-col-end" colspan="{% widthratio total_time 2 1 %}">
									Present
								</td>
							</tr>
						</table>	
					</div>
					{% endif %}
				</div>
				<div class="pull-left span6">	
>>>>>>> 847140c0045ffa11f1cf7c7f0528281c65d22d84
					
						<div class="clear"></div>
					
						<div class="path-viz" ondragover='allowDrop(event)'>
						<div class="path-viz-short">

							<!-- Education  -->
							{% if ed %}
								<h5>Education: </h5>
								<div class='ed_list'>
									<table class="table table-striped table-condensed table-bordered position-list">
									{% for pos in ed %}
									<!-- <div class="indent timeline-ed"> -->
										<tr>
											{% if pos.title %}
												<td>{{pos.title}}</td>
											{% endif %}
											
											<td>{{pos.co_name}}</td>			
										</tr>
									<!-- </div> 			 -->
									{% endfor %}
									</table>
								</div>
							{% endif %}

							<!-- Experience -->
							{% if orgs %}
								<h5>Experience: </h5>
								<div class='org_list'>
								<table class="table table-striped table-condensed table-bordered position-list">
								{% for pos in orgs %}
									<!-- <div class="{{profile.id}}-list indent"> -->

									<tr onmouseover="showDescription({{forloop.counter0}}, '{{pos.title}}', '{{pos.co_name}}', '{{pos.start_date}}', '{{pos.end_date}}')" draggable='true' ondragstart='dragPos(event)' id="{{pos.id}}">	
										{% if pos.title %}
											<td>{{pos.title}}</td>
										{% endif %}	

										<td>{{pos.co_name}}</td>
												
										
											<span class="timeline-description timeline-description-float {{pos.id}}-description" style="display:none">
												<span class="timeline-description-text">
												{% if pos.description %}				
													{{pos.description}}
												{% endif %}
												</span>
											</span>
									
										</tr>
									<!-- </div> -->
								{% endfor %}
								</table>
								</div>
							{% endif %}
							</div>			
						</div>
					</div>
					<!-- Float Screen -->
					<div id="middle-float-screen" class="pull-left span6" ondragover='allowDrop(event)'>
						{% if career_decision_prompt %}
							<div id='career-decision-module'>
								<div id="career-decision-prompt">
								<button class="close">&times;</button>
								Would you provide a bit of information on your decision to 
								{% if career_decision_prompt.type == 'education' %}
									attend 
								{% else %}
									work as a {{career_decision_prompt.title}} at 
								{% endif %}
								{{career_decision_prompt.co_name}}? This information will go directly to others who are making the same important career decisions.  
								<div class='btn career-decision-prompt-btn' onclick='revealPrompt()'>Sure</div>
								</div>
								<div id="career-decision-form" class="display-none">
								<div class='callout-text'>Thanks you for sharing, this information will be invaluable to others just like you.</div>
								<br/>
								<form class='form'>
									<input type='text' class='full-width' placeholder='Where else did you considering working?' name='alternates' id='alternatesTextBox'/><br/>
									{% if career_decision_prompt.type == 'education' %}
									<textarea rows='2' class="full-width" name='reason' placeholder='Why did you decide to attend {{career_decision_prompt.co_name}}'></textarea>
									{% else %}
									<textarea rows='2' class='full-width' name='reason' placeholder='Why did you decide to work at {{career_decision_prompt.co_name}}?'></textarea>
									{% endif %}
									<label>On a scale from 1-5, please rate the following elements of your experience at {{career_decision_prompt.co_name}}.</label>
								<div id="mentorshipCheckboxes">
									<div id='control-headers'>
										<span id='worst'>Poor</span>
										<span id='best'>Excellent</span>
									</div>
									<div id='radio-set-mentorship'>
									<span class='input-label'>Mentorship:</span>
									<label class="radio inline">
  										<input type="radio" id="mentorshipNA" name='mentorship-radio' value="0"> n/a
									</label>
									<label class="radio inline">
  										<input type="radio" id="mentorship1" name='mentorship-radio' value="1"> 1
									</label>
									<label class="radio inline">
  										<input type="radio" id="mentorship2" name='mentorship-radio' value="2"> 2
									</label>
									<label class="radio inline">
  										<input type="radio" id="mentorship3" name='mentorship-radio' value="3"> 3
									</label>
									<label class="radio inline">
  										<input type="radio" id="mentorship4" name='mentorship-radio' value="4"> 4
									</label>
									<label class="radio inline">
  										<input type="radio" id="mentorship5" name='mentorship-radio' value="5"> 5
									</label>
									
									</div>

									<div id='radio-set-skills'>
									<span class='input-label'>Skills Gained:</span>
									<label class="radio inline">
  										<input type="radio" name='skills-radio' id="skillsNA" value="0"> n/a
									</label>
									<label class="radio inline">
  										<input type="radio" name='skills-radio' id="skills1" value="1"> 1
									</label>
									<label class="radio inline">
  										<input type="radio" name='skills-radio' id="skills2" value="2"> 2
									</label>
									<label class="radio inline">
  										<input type="radio" name='skills-radio' id="skills3" value="3"> 3
									</label>
									<label class="radio inline">
  										<input type="radio" name='skills-radio' id="skills4" value="4"> 4
									</label>
									<label class="radio inline">
  										<input type="radio" name='skills-radio' id="skills5" value="5"> 5
									</label>
									</div>

									<div id='radio-set-social'>
									<span class='input-label'>
									Social/Environment:</span>
									<label class="radio inline">
  										<input type="radio" name='social-radio' id="socialNA" value="0"> n/a
									</label>
									<label class="radio inline">
  										<input type="radio" name='social-radio' id="social1" value="1"> 1
									</label>
									<label class="radio inline">
  										<input type="radio" name='social-radio' id="social2" value="2"> 2
									</label>
									<label class="radio inline">
  										<input type="radio" name='social-radio' id="social3" value="3"> 3
									</label>
									<label class="radio inline">
  										<input type="radio" name='social-radio' id="social4" value="4"> 4
									</label>
									<label class="radio inline">
  										<input type="radio" name='social-radio' id="social5" value="5"> 5
									</label>
									</div>

									<div id='radio-set-overall'>	
									<span class='input-label'>Overall:</span>
									<label class="radio inline">
  										<input type="radio" name='overall-radio' id="overallNA" value="0"> n/a
									</label>
									<label class="radio inline">
  										<input type="radio" name='overall-radio' id="overall1" value="1"> 1
									</label>
									<label class="radio inline">
  										<input type="radio" name='overall-radio' id="overall2" value="2"> 2
									</label>
									<label class="radio inline">
  										<input type="radio" name='overall-radio' id="overall3" value="3"> 3
									</label>
									<label class="radio inline">
  										<input type="radio" name='overall-radio' id="overall4" value="4"> 4
									</label>
									<label class="radio inline">
  										<input type="radio" name='overall-radio' id="overall5" value="5"> 5
									</label>
									</div>
								</div>
								<br/>
								{% if career_decision_prompt.type == 'education' %}
								<textarea rows='2' class='full-width' name='comments' placeholder='Any additional comments for people considering attending {{career_decision_prompt.co_name}}?'</textarea>
								{% else %}
								<textarea rows='2' class='full-width' name='comments' placeholder='Any additional comments for people considering working at {{career_decision_prompt.co_name}}?'></textarea>
								{% endif %}
								<br/>
								<div>Select how you want this information to be displayed:</div>
								<div id='privacy-radio'>
								<label class="radio inline">
  									<input type="radio" name='privacy-radio' value="anonymous"/ > Anonymous
								</label>
								<label class='radio inline'>
									<input type='radio' name='privacy-radio' value='public' />Public
								</label>
								</div>
								<br/>
								<div class='btn submitBtn' onclick='submitCareerDecision({{career_decision_prompt.id}})'>Done</div>

								</form>
								</div>
							</div>
						{% else %}
						<a>For more information, hover over a position</a>
						{% endif %}
					</div>	
					<div class="clear"></div>
<<<<<<< HEAD
				</div>
			
				<div class="profile-viz-container">
					<!-- TIMELINE. DON'T. TOUCH. IT. -->
					{% if orgs|length > 0 %}
					<div class="timeline-container span12">
						<table id='timeline' class="timeline">
							<!-- Row per Position -->
							{% for p in orgs %}
								<tr class="timeline-row">
									{% load months_difference rangify subtract divide %}

									{% if compress %}
										{% for i in start_date|months_difference:start_date|divide:2|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% else %}
										{% for i in p.start_date|months_difference:start_date|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% endif %}

									<!-- Highlighted Segment -->
									<td class="timeline-col-highlighted" colspan="{{p.duration}}">{{p.co_name}}</td>

									{% if compress %}
										{% for i in end_date|months_difference:p.end_date|divide:2|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% else %}
										{% for i in end_date|months_difference:p.end_date|rangify %}
											<td class="timeline-col"></td>
										{% endfor %}
									{% endif %}
								</tr>
							{% endfor %}

							<!-- Bottom Row -->
							<tr class="timeline-row-bottom">
								<td class="timeline-col-start" colspan="{% widthratio total_time 2 1 %}">
									{{start_date.month}}/{{start_date.year}}
								</td>
								<td class="timeline-col-end" colspan="{% widthratio total_time 2 1 %}">
									Present
								</td>
							</tr>
						</table>	
					</div>
					{% endif %}
				</div>
=======
>>>>>>> 847140c0045ffa11f1cf7c7f0528281c65d22d84
			</div>

			<!-- Right Sidebar -->
			<div id="profile-right" class="span3 pad-down pull-right">
				<div class="rounded">
					{% if user %}
						<p class="sidebar-header">Want to see improvements?</p>
						<p>We'd love to hear from you -- <a href="mailto:feedback@prosperime.com">please drop us a line</a></p>
					{% endif %}
				</div>

				<!-- Profile Saved Paths -->
				<!-- <div class="rounded">
					<p class="sidebar-header">{{profile.first_name}}'s Saved Career Paths</p>

					{% if saved_paths %}
						<table class="table table-striped table-condensed table-bordered position-list">		
						{% for path in saved_paths %}
							<tr>
								<td><a href="/saved_paths/#title/?t={{path.title}}"> {{path.title}} </a></td>
							</tr>
						{%endfor%}
						</table>
					{% else %}
						<p>{{profile.first_name}} hasn't saved any career paths yet.</p>
					{% endif %}
				</div> -->

				<!-- Viewer Saved Paths -->
				<div class="rounded">
					<p class="sidebar-header">Your Saved Career Paths</p>
					<p> Like what {{profile.first_name}} has done? Drag any of the positions shown into your desired career path or <a onclick='createNewPath()'>create a new one.</a></p>
						<table class="table table-striped table-condensed table-bordered path-list" id='sidebar-path-list'>			
							<tr><td class="timeline-description-header">
								<a href="/saved_paths/">View All</a>
							</td></tr>
						{% for saved_path in viewer_saved_paths %}
							{% if forloop.last %}
								<tr class="saved-path-list-last">
							{% else %}
								<tr>
							{% endif %}
								<td ondragover='allowDrop(event)' ondrop='dropPosition(event, "{{saved_path.title|escape}}", this)'><a href="/saved_paths/#id/?id={{saved_path.id}}">{{saved_path.title}}</a></td>
								</tr>
						{% endfor %}
						</table>	
				</div>
			</div>
			<div class="clear"></div>
		</div>
		
<script type="text/javascript">

<<<<<<< HEAD
	/* Page-specific drag for GA */
=======

>>>>>>> 847140c0045ffa11f1cf7c7f0528281c65d22d84
	function dragPos(ev) {
  		ev.dataTransfer.setData("pos_id", ev.target.id);
    	_gaq.push(['_trackEvent', 'profile', 'positionDragged'])
  	};


	/* Need JQuery for the AJAX request, so put it here */
	var dropPosition = function(ev, path_title, elem) {
		_gaq.push(['_trackEvent', 'profile', 'positionDropped'])
		ev.preventDefault();
		var pos_id = ev.dataTransfer.getData("pos_id");

		$.post('/saved_paths/save/', {title: path_title, pos_id: pos_id, csrfmiddlewaretoken: '{{csrf_token}}'}, function(response) {
				console.log(response)
				if (response['success']) {
					highlight(elem)
				}
		}, 'json');
	};

	/* Inelegant but effective way to pulsate the element w/o
	   external JQuery libraries */
	var highlight = function(elem) {
		$(elem).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);
	};

	var newPathAjax = function() {
		_gaq.push(['_trackEvent', 'profile', 'newPathCreated'])

		var title = $('#new-path-box').val()
		if (title.length < 1) {
			errorCreatingPath('title')
			return
		}

		// Attempt POST request via AJAX to create path
		$.post('/saved_paths/create/', {title: title, csrfmiddlewaretoken: '{{csrf_token}}'}, function(response) {
				if (response['success']) {
					console.log(response)
					// Construct new table element for path
					var newRow = "<tr><td ondragover='allowDrop(event)' ondrop='dropPosition(event," + title + ", this)'><a href='/saved_paths/#id/?id=" + response['id'] + "'>" + title + "</a></td></tr>"

					// Add to DOM
					$('#sidebar-path-list > tbody:last').append(newRow)
					
					// Clear text field
					$('#new-path-box-row').remove()
				} else {
					errorCreatingPath('db')
				}
		}, 'json');
	};

	var errorCreatingPath = function(reason) {
		_gaq.push(['_trackEvent', 'profile', 'errorCreatingPath'])
	
		var createBox = $('#new-path-box')
		if (reason == "db") {
			console.log("Error in the view creating new path...")
			createBox.val("Please enter a title")
		} else if (reason == "title") {
			createBox.val("Please enter a title")
		}

		highlight(createBox)
	};

	/* Used in profile pages. Onmouseover event renders the description
	   for a given element in the element id='middle-float-screen' */
	var showDescription = function(index, title, co_name, start_date, end_date) {
		// Don't override the prompt!
		if ($('#career-decision-module').length > 0) {
			console.log('got in here')
			return false;
		}

		// Empty what's in the float screen
		$('#middle-float-screen').empty()
		// If no description, will throw exception
		try {
			// Couldn't get this to work in JQ so stopped trying
			var description = document.getElementsByClassName('timeline-description-text')[index].innerHTML
			var newText = "<div class='box-header'>"
			if (title) newText += title
			if (co_name) newText += ' at ' + co_name
			newText += "</div>"
			if (start_date) {
				newText += "<div class='box-dates'>"
				newText += start_date.replace('1, ','')
				newText += ' - '
				if (end_date == "Current") newText += "Current"
				else newText += end_date.replace('1, ', '')
				newText += "</div>"
			}

			if (description) newText += "<div class='box-description'>" + description + "</div>"
		} catch (err) {
			var newText = '<a>For more information, hover over a position</a>'
		}
		$('#middle-float-screen').html(newText);
	};


	var revealPrompt = function() {
		$('#career-decision-prompt').hide()
		$('#career-decision-form').toggleClass('display-none')
		$('#profile-left').css('opacity','.4')
		$('#profile-right').css('opacity','.4')
		$('#timeline').css('opacity', '.4')
	}

	var submitCareerDecision = function(pos_id) { 

		var alternates = $('input[name="alternates"]', '#career-decision-form').val()
		if (alternates === undefined) alternates = null
		var reason = $('textarea[name="reason"]', '#career-decision-form').val()
		if (reason === undefined) reason = null
		var mentorship = $('input[name="mentorship-radio"]:checked').val()	
		if (mentorship === undefined) mentorship = 0
		var skills = $('input[name="skills-radio"]:checked').val()
		if (skills === undefined) skills = 0
		var social = $('input[name="social-radio"]:checked').val()
		if (social === undefined) social = 0
		var overall = $('input[name="overall-radio"]:checked').val()
		if (overall === undefined) overall = 0


		var comments = $('textarea[name="comments"]','#career-decision-form').val()
		if (comments === undefined) comments=null
		var privacy = $('input[name="privacy-radio"]:checked').val()

		$.post('/careers/addDecision/', {pos_id: pos_id, alternates: alternates, reason: reason, mentorship: mentorship, skills: skills, social:social, overall: overall, comments: comments, privacy: privacy, csrfmiddlewaretoken: '{{csrf_token}}'}, function(response) {
				console.log(response)
		}, 'json');

		$('#middle-float-screen').empty()
		$('#middle-float-screen').append('<a>For more information, hover over a position</a>')
		$('#profile-left').css('opacity','1')
		$('#profile-right').css('opacity','1')
		$('#timeline').css('opacity', '1')

	}


	/* Adds autocomplete to 'Alternates' textbox */
	$('#alternatesTextBox').autocomplete({
    	serviceUrl: '/careers/entityAutocomplete/',
    	delimiter: ', ',
    });

	/* Prevents submitting the form when 'Enter' is pressed */
    $('#career-decision-form').bind("keyup", function(e) {
  		var code = e.keyCode || e.which; 
  		if (code  == 13) {     
    		e.preventDefault();
    		return false;
  		}
	});




</script>

{% endblock %}


